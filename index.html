<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ë¦¬ ì•„ì´ ì‹œê°„í‘œ</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { School, Sun, Edit2, Save, X, Trash2, Settings, Copy, Share2, HelpCircle, ChevronRight, ChevronLeft, AlertCircle, Plus, Clock, Bell, Calendar, Camera, Link } = lucide;

        // ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ ë˜í¼
        const Icon = ({ icon: IconComponent, ...props }) => {
            useEffect(() => {
                lucide.createIcons();
            }, []);
            return <i data-lucide={IconComponent} {...props}></i>;
        };

        const TimetableApp = () => {
          // ì²« ë°©ë¬¸ ì²´í¬
          const [isFirstVisit, setIsFirstVisit] = useState(() => {
            if (typeof window !== 'undefined' && window.localStorage) {
              return !localStorage.getItem('hasVisited');
            }
            return true;
          });
          
          // ì˜¨ë³´ë”© ë‹¨ê³„
          const [onboardingStep, setOnboardingStep] = useState(0);
          
          // ê¸°ë³¸ê°’ ì •ì˜
          const DEFAULT_SCHEDULE_STRUCTURES = {
            regular: [
              { id: 'morning', name: 'ì•„ì¹¨ë…ì„œ', start: '08:40', end: '08:50', isBreak: true },
              { id: 'period1', name: '1êµì‹œ', start: '08:50', end: '09:30', isBreak: false },
              { id: 'period2', name: '2êµì‹œ', start: '09:40', end: '10:20', isBreak: false },
              { id: 'break1', name: 'ì‰¬ëŠ”ì‹œê°„', start: '10:20', end: '10:30', isBreak: true },
              { id: 'period3', name: '3êµì‹œ', start: '10:30', end: '11:10', isBreak: false },
              { id: 'period4', name: '4êµì‹œ', start: '11:20', end: '12:00', isBreak: false },
              { id: 'lunch', name: 'ì ì‹¬ì‹œê°„', start: '12:00', end: '12:50', isBreak: true },
              { id: 'period5', name: '5êµì‹œ', start: '12:50', end: '13:30', isBreak: false }
            ],
            vacation: [
              { id: 'morning', name: 'ì˜¤ì „ìˆ˜ì—…', start: '09:00', end: '10:30', isBreak: false },
              { id: 'break', name: 'ì‰¬ëŠ”ì‹œê°„', start: '10:30', end: '10:40', isBreak: true },
              { id: 'activity', name: 'íŠ¹ë³„í™œë™', start: '10:40', end: '12:00', isBreak: false }
            ]
          };

          const DEFAULT_SCHOOL_SETTINGS = {
            regular: { 
              startTime: '08:50', 
              periodDuration: 40, 
              breakDuration: 10,
              scheduleType: 'regular',
              shortDayEnabled: true,
              lunchDuration: 50,
              morningReadingEnabled: true
            },
            vacation: { 
              startTime: '09:00', 
              periodDuration: 90, 
              breakDuration: 10,
              scheduleType: 'regular',
              shortDayEnabled: false,
              lunchDuration: 50,
              morningReadingEnabled: false
            }
          };

          const DEFAULT_AFTER_SCHOOL = {
            regular: { 1: [], 2: [], 3: [], 4: [], 5: [] },
            vacation: { 1: [], 2: [], 3: [], 4: [], 5: [] }
          };

          const DEFAULT_TIMETABLES = {
            regular: { 1: {}, 2: {}, 3: {}, 4: {}, 5: {} },
            vacation: { 1: {}, 2: {}, 3: {}, 4: {}, 5: {} }
          };

          const DEFAULT_SUBJECTS = [
            'êµ­ì–´', 'ìˆ˜í•™', 'ì˜ì–´', 'ê³¼í•™', 'ì‚¬íšŒ',
            'ì²´ìœ¡', 'ìŒì•…', 'ë¯¸ìˆ ', 'ë„ë•', 'ì‹¤ê³¼',
            'í†µí•©êµê³¼(ì „ë‹´)', 
            'ì°½ì²´', 'ììœ¨', 'ë™ì•„ë¦¬', 'ë´‰ì‚¬', 'ì§„ë¡œ',
            'ì•ˆì „êµìœ¡', 'ë³´ê±´', 'ë§ˆì„', 'ì„¸ê³„'
          ];

          // í•™ë…„ë³„ ê¸°ë³¸ ì‹œê°„í‘œ í…œí”Œë¦¿
          const GRADE_TEMPLATES = {
            '1-2í•™ë…„': {
              subjects: ['êµ­ì–´', 'ìˆ˜í•™', 'í†µí•©êµê³¼(ì „ë‹´)', 'ì°½ì²´', 'ë§ˆì„'],
              scheduleType: 'block',
              message: '1-2í•™ë…„ì€ ë¸”ë¡ ìˆ˜ì—…ì´ ì¼ë°˜ì ì…ë‹ˆë‹¤'
            },
            '3-4í•™ë…„': {
              subjects: ['êµ­ì–´', 'ìˆ˜í•™', 'ì˜ì–´', 'ê³¼í•™', 'ì‚¬íšŒ', 'ì²´ìœ¡', 'ìŒì•…', 'ë¯¸ìˆ ', 'ì°½ì²´', 'ë§ˆì„', 'ì„¸ê³„'],
              scheduleType: 'regular',
              message: '3-4í•™ë…„ë¶€í„° êµê³¼ëª©ì´ ì„¸ë¶„í™”ë©ë‹ˆë‹¤'
            },
            '5-6í•™ë…„': {
              subjects: ['êµ­ì–´', 'ìˆ˜í•™', 'ì˜ì–´', 'ê³¼í•™', 'ì‚¬íšŒ', 'ì²´ìœ¡', 'ìŒì•…', 'ë¯¸ìˆ ', 'ì‹¤ê³¼', 'ì°½ì²´', 'ì„¸ê³„'],
              scheduleType: 'regular',
              message: '5-6í•™ë…„ì€ ì‹¤ê³¼ ê³¼ëª©ì´ ì¶”ê°€ë©ë‹ˆë‹¤'
            }
          };

          const [currentTime, setCurrentTime] = useState(new Date());
          const [activeTab, setActiveTab] = useState('today');
          const [editMode, setEditMode] = useState(false);
          const [selectedSubject, setSelectedSubject] = useState('');
          const [newSubject, setNewSubject] = useState('');
          const [autoAdjustTime, setAutoAdjustTime] = useState(true);
          const [scheduleMode, setScheduleMode] = useState(() => {
            if (typeof window !== 'undefined' && window.localStorage) {
              return localStorage.getItem('scheduleMode') || 'regular';
            }
            return 'regular';
          });

          // í•™êµ ì„¤ì •
          const [schoolSettings, setSchoolSettings] = useState(() => {
            if (typeof window !== 'undefined' && window.localStorage) {
              try {
                const saved = localStorage.getItem('schoolSettings');
                const parsed = saved ? JSON.parse(saved) : null;
                if (parsed) {
                  return {
                    regular: {
                      ...DEFAULT_SCHOOL_SETTINGS.regular,
                      ...parsed.regular,
                      morningReadingEnabled: parsed.regular?.morningReadingEnabled ?? true
                    },
                    vacation: {
                      ...DEFAULT_SCHOOL_SETTINGS.vacation,
                      ...parsed.vacation
                    }
                  };
                }
              } catch (error) {
                console.error('Error loading schoolSettings:', error);
              }
            }
            return DEFAULT_SCHOOL_SETTINGS;
          });
          
          // êµì‹œ êµ¬ì¡°
          const [scheduleStructures, setScheduleStructures] = useState(() => {
            if (typeof window !== 'undefined' && window.localStorage) {
              try {
                const saved = localStorage.getItem('scheduleStructures');
                const parsed = saved ? JSON.parse(saved) : null;
                if (parsed && parsed.regular && parsed.vacation) {
                  return parsed;
                }
              } catch (error) {
                console.error('Error loading scheduleStructures:', error);
              }
            }
            
            return DEFAULT_SCHEDULE_STRUCTURES;
          });

          const scheduleStructure = scheduleStructures[scheduleMode];

          // ë°©ê³¼í›„ í”„ë¡œê·¸ë¨
          const [afterSchoolPrograms, setAfterSchoolPrograms] = useState(() => {
            if (typeof window !== 'undefined' && window.localStorage) {
              try {
                const saved = localStorage.getItem('afterSchoolPrograms');
                const parsed = saved ? JSON.parse(saved) : null;
                if (parsed && parsed.regular && parsed.vacation) {
                  return parsed;
                }
              } catch (error) {
                console.error('Error loading afterSchoolPrograms:', error);
              }
            }
            
            return DEFAULT_AFTER_SCHOOL;
          });
          
          // ìì£¼ ì“°ëŠ” ê³¼ëª©
          const [favoriteSubjects, setFavoriteSubjects] = useState(() => {
            if (typeof window !== 'undefined' && window.localStorage) {
              try {
                const saved = localStorage.getItem('favoriteSubjects');
                return saved ? JSON.parse(saved) : DEFAULT_SUBJECTS;
              } catch (error) {
                console.error('Error loading favoriteSubjects:', error);
              }
            }
            return DEFAULT_SUBJECTS;
          });
          
          // ì‹œê°„í‘œ ë°ì´í„°
          const [timetables, setTimetables] = useState(() => {
            if (typeof window !== 'undefined' && window.localStorage) {
              try {
                const saved = localStorage.getItem('timetables');
                const parsed = saved ? JSON.parse(saved) : null;
                if (parsed && parsed.regular && parsed.vacation) {
                  return parsed;
                }
              } catch (error) {
                console.error('Error loading timetables:', error);
              }
            }
            
            return DEFAULT_TIMETABLES;
          });

          const days = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];

          // ê³¼ëª©ë³„ ìƒ‰ìƒ
          const getSubjectColor = (subject) => {
            if (!subject) return 'text-gray-400';
            
            const colorMap = {
              'êµ­ì–´': 'bg-red-100 text-red-700 border-red-300',
              'ìˆ˜í•™': 'bg-blue-100 text-blue-700 border-blue-300',
              'ì˜ì–´': 'bg-purple-100 text-purple-700 border-purple-300',
              'ê³¼í•™': 'bg-green-100 text-green-700 border-green-300',
              'ì‚¬íšŒ': 'bg-yellow-100 text-yellow-700 border-yellow-300',
              'ì²´ìœ¡': 'bg-orange-100 text-orange-700 border-orange-300',
              'ìŒì•…': 'bg-pink-100 text-pink-700 border-pink-300',
              'ë¯¸ìˆ ': 'bg-indigo-100 text-indigo-700 border-indigo-300',
              'ì°½ì²´': 'bg-gray-100 text-gray-700 border-gray-300',
              'ììœ¨': 'bg-violet-100 text-violet-700 border-violet-300',
              'ë™ì•„ë¦¬': 'bg-emerald-100 text-emerald-700 border-emerald-300',
              'ë´‰ì‚¬': 'bg-lime-100 text-lime-700 border-lime-300',
              'ì§„ë¡œ': 'bg-sky-100 text-sky-700 border-sky-300',
              'ì‹¤ê³¼': 'bg-teal-100 text-teal-700 border-teal-300',
              'ë„ë•': 'bg-amber-100 text-amber-700 border-amber-300',
              'í†µí•©êµê³¼(ì „ë‹´)': 'bg-rose-100 text-rose-700 border-rose-300',
              'ë³´ê±´': 'bg-green-200 text-green-800 border-green-400',
              'ì•ˆì „êµìœ¡': 'bg-red-200 text-red-800 border-red-400',
              'ë§ˆì„': 'bg-cyan-100 text-cyan-700 border-cyan-300',
              'ì„¸ê³„': 'bg-fuchsia-100 text-fuchsia-700 border-fuchsia-300',
              'ì„ íƒí˜•ëŠ˜ë´„': 'bg-blue-200 text-blue-800 border-blue-400',
              'ë§ì¶¤í˜•ëŠ˜ë´„': 'bg-purple-200 text-purple-800 border-purple-400',
              'ëŒë´„êµì‹¤': 'bg-green-200 text-green-800 border-green-400'
            };
            
            if (subject === 'í†µí•©êµê³¼(ì „ë‹´)') {
              return colorMap['í†µí•©êµê³¼(ì „ë‹´)'];
            }
            
            if (subject.includes('ììœ¨') || subject.includes('ë™ì•„ë¦¬') || 
                subject.includes('ë´‰ì‚¬') || subject.includes('ì§„ë¡œ')) {
              return colorMap[subject.split(' ')[0]] || colorMap['ì°½ì²´'];
            }
            
            if (subject.includes('í•™ì›')) {
              return 'bg-amber-100 text-amber-700 border-amber-300';
            }
            
            return colorMap[subject] || 'bg-blue-100 text-blue-700 border-blue-300';
          };

          // ì‹œê°„ì„ ë¶„ìœ¼ë¡œ ë³€í™˜
          const timeToMinutes = (time) => {
            const [hour, min] = time.split(':').map(Number);
            return hour * 60 + min;
          };

          // ë¶„ì„ ì‹œê°„ìœ¼ë¡œ ë³€í™˜
          const minutesToTime = (minutes) => {
            const hour = Math.floor(minutes / 60);
            const min = minutes % 60;
            return `${hour.toString().padStart(2, '0')}:${min.toString().padStart(2, '0')}`;
          };

          // ì‹œê°„ ì¤‘ë³µ ì²´í¬
          const checkTimeOverlap = (periods, newPeriod, excludeId = null) => {
            const newStart = timeToMinutes(newPeriod.start);
            const newEnd = timeToMinutes(newPeriod.end);
            
            return periods.some(period => {
              if (period.id === excludeId) return false;
              const start = timeToMinutes(period.start);
              const end = timeToMinutes(period.end);
              
              return (newStart < end && newEnd > start);
            });
          };

          // ì‹œê°„ìˆœìœ¼ë¡œ ì •ë ¬
          const sortPeriods = (periods) => {
            return [...periods].sort((a, b) => {
              const timeA = timeToMinutes(a.start);
              const timeB = timeToMinutes(b.start);
              return timeA - timeB;
            });
          };

          // ìë™ ì‹œê°„ ìƒì„±
          const generateAutoSchedule = () => {
            const settings = schoolSettings[scheduleMode];
            const periods = [];
            
            if (settings.morningReadingEnabled) {
              periods.push({
                id: 'morning',
                name: 'ì•„ì¹¨ë…ì„œ',
                start: '08:40',
                end: '08:50',
                isBreak: true
              });
            }
            
            if (settings.scheduleType === 'block') {
              periods.push(
                { id: 'block1_1', name: '1ë¸”ë¡(1,2êµì‹œ)', start: '08:50', end: '10:10', isBreak: false },
                { id: 'break1', name: 'ì‰¬ëŠ”ì‹œê°„', start: '10:10', end: '10:40', isBreak: true },
                { id: 'block2_1', name: '2ë¸”ë¡(3,4êµì‹œ)', start: '10:40', end: '12:00', isBreak: false },
                { id: 'lunch', name: 'ì ì‹¬ì‹œê°„', start: '12:00', end: '12:50', isBreak: true }
              );
              
              if (!settings.shortDayEnabled) {
                periods.push(
                  { id: 'period5', name: '5êµì‹œ', start: '12:50', end: '13:30', isBreak: false }
                );
              }
            } else if (settings.scheduleType === 'mixed') {
              periods.push(
                { id: 'period1', name: '1êµì‹œ', start: '08:50', end: '09:30', isBreak: false, blockName: '1ë¸”ë¡' },
                { id: 'period2', name: '2êµì‹œ', start: '09:30', end: '10:10', isBreak: false, blockName: '1ë¸”ë¡' },
                { id: 'break1', name: 'ì‰¬ëŠ”ì‹œê°„', start: '10:10', end: '10:40', isBreak: true },
                { id: 'period3', name: '3êµì‹œ', start: '10:40', end: '11:20', isBreak: false, blockName: '2ë¸”ë¡' },
                { id: 'period4', name: '4êµì‹œ', start: '11:20', end: '12:00', isBreak: false, blockName: '2ë¸”ë¡' },
                { id: 'lunch', name: 'ì ì‹¬ì‹œê°„', start: '12:00', end: '12:50', isBreak: true }
              );
              
              if (!settings.shortDayEnabled) {
                periods.push(
                  { id: 'period5', name: '5êµì‹œ', start: '12:50', end: '13:30', isBreak: false }
                );
              }
            } else {
              const startMinutes = timeToMinutes(settings.startTime);
              let currentTime = startMinutes;
              let periodCount = scheduleMode === 'regular' ? 6 : 3;
              
              for (let i = 1; i <= periodCount; i++) {
                periods.push({
                  id: `period${i}`,
                  name: `${i}êµì‹œ`,
                  start: minutesToTime(currentTime),
                  end: minutesToTime(currentTime + settings.periodDuration),
                  isBreak: false
                });
                currentTime += settings.periodDuration;
                
                if (i < periodCount && i !== (scheduleMode === 'regular' ? 4 : 2)) {
                  periods.push({
                    id: `break${i}`,
                    name: 'ì‰¬ëŠ”ì‹œê°„',
                    start: minutesToTime(currentTime),
                    end: minutesToTime(currentTime + settings.breakDuration),
                    isBreak: true
                  });
                  currentTime += settings.breakDuration;
                }
                
                if (i === (scheduleMode === 'regular' ? 4 : 2)) {
                  periods.push({
                    id: 'lunch',
                    name: 'ì ì‹¬ì‹œê°„',
                    start: minutesToTime(currentTime),
                    end: minutesToTime(currentTime + settings.lunchDuration),
                    isBreak: true
                  });
                  currentTime += settings.lunchDuration;
                }
              }
            }
            
            if (settings.shortDayEnabled) {
              const shortDayPeriods = periods.filter(p => 
                !p.id.includes('period5') && p.id !== 'period5'
              );
              
              setScheduleStructures(prev => ({
                ...prev,
                [scheduleMode]: periods,
                [`${scheduleMode}_short`]: shortDayPeriods
              }));
            } else {
              setScheduleStructures(prev => ({
                ...prev,
                [scheduleMode]: periods
              }));
            }
          };

          useEffect(() => {
            const timer = setInterval(() => setCurrentTime(new Date()), 60000);
            return () => clearInterval(timer);
          }, []);

          useEffect(() => {
            lucide.createIcons();
          });

          useEffect(() => {
            if (typeof window !== 'undefined' && window.localStorage) {
              localStorage.setItem('timetables', JSON.stringify(timetables));
            }
          }, [timetables]);

          useEffect(() => {
            if (typeof window !== 'undefined' && window.localStorage) {
              localStorage.setItem('favoriteSubjects', JSON.stringify(favoriteSubjects));
            }
          }, [favoriteSubjects]);

          useEffect(() => {
            if (typeof window !== 'undefined' && window.localStorage) {
              localStorage.setItem('scheduleStructures', JSON.stringify(scheduleStructures));
            }
          }, [scheduleStructures]);

          useEffect(() => {
            if (typeof window !== 'undefined' && window.localStorage) {
              localStorage.setItem('afterSchoolPrograms', JSON.stringify(afterSchoolPrograms));
            }
          }, [afterSchoolPrograms]);

          useEffect(() => {
            if (typeof window !== 'undefined' && window.localStorage) {
              localStorage.setItem('scheduleMode', scheduleMode);
            }
          }, [scheduleMode]);

          useEffect(() => {
            if (typeof window !== 'undefined' && window.localStorage) {
              localStorage.setItem('schoolSettings', JSON.stringify(schoolSettings));
            }
          }, [schoolSettings]);

          const addPeriod = () => {
            const newId = `period_${Date.now()}`;
            const currentSchedule = Array.isArray(scheduleStructure) ? scheduleStructure : [];
            const lastPeriod = currentSchedule[currentSchedule.length - 1];
            const newPeriod = {
              id: newId,
              name: 'ìƒˆ êµì‹œ',
              start: lastPeriod?.end || '14:00',
              end: minutesToTime(timeToMinutes(lastPeriod?.end || '14:00') + 40),
              isBreak: false
            };
            
            const updatedSchedule = sortPeriods([...currentSchedule, newPeriod]);
            
            setScheduleStructures(prev => ({
              ...prev,
              [scheduleMode]: updatedSchedule
            }));
          };

          const updatePeriod = (id, field, value) => {
            setScheduleStructures(prev => {
              let updated = prev[scheduleMode].map(period =>
                period.id === id ? { ...period, [field]: value } : period
              );
              
              if (autoAdjustTime && (field === 'start' || field === 'end')) {
                const sortedPeriods = sortPeriods(updated);
                const currentIndex = sortedPeriods.findIndex(p => p.id === id);
                
                if (field === 'end' && currentIndex < sortedPeriods.length - 1) {
                  const nextPeriod = sortedPeriods[currentIndex + 1];
                  updated = updated.map(p => 
                    p.id === nextPeriod.id ? { ...p, start: value } : p
                  );
                } else if (field === 'start' && currentIndex > 0) {
                  const prevPeriod = sortedPeriods[currentIndex - 1];
                  updated = updated.map(p => 
                    p.id === prevPeriod.id ? { ...p, end: value } : p
                  );
                }
              }
              
              if (field === 'start' || field === 'end') {
                return {
                  ...prev,
                  [scheduleMode]: sortPeriods(updated)
                };
              }
              
              return {
                ...prev,
                [scheduleMode]: updated
              };
            });
          };

          const deletePeriod = (id) => {
            setScheduleStructures(prev => ({
              ...prev,
              [scheduleMode]: prev[scheduleMode].filter(period => period.id !== id)
            }));
            
            setTimetables(prev => {
              const newTimetables = { ...prev };
              for (let day = 1; day <= 5; day++) {
                if (newTimetables[scheduleMode][day] && newTimetables[scheduleMode][day][id]) {
                  delete newTimetables[scheduleMode][day][id];
                }
              }
              return newTimetables;
            });
          };

          const updateSchoolSettings = (field, value) => {
            setSchoolSettings(prev => ({
              ...prev,
              [scheduleMode]: {
                ...prev[scheduleMode],
                [field]: field === 'startTime' || field === 'scheduleType' 
                  ? value 
                  : field === 'shortDayEnabled' || field === 'morningReadingEnabled'
                  ? value 
                  : Number(value)
              }
            }));
          };

          const addAfterSchoolProgram = (day) => {
            const programs = afterSchoolPrograms[scheduleMode][day] || [];
            const lastProgram = programs[programs.length - 1];
            const newProgram = {
              id: Date.now(),
              name: '',
              start: lastProgram?.end || '14:00',
              end: '15:00'
            };
            
            setAfterSchoolPrograms(prev => ({
              ...prev,
              [scheduleMode]: {
                ...prev[scheduleMode],
                [day]: [...programs, newProgram]
              }
            }));
          };

          const updateAfterSchoolProgram = (day, id, field, value) => {
            setAfterSchoolPrograms(prev => ({
              ...prev,
              [scheduleMode]: {
                ...prev[scheduleMode],
                [day]: prev[scheduleMode][day].map(program =>
                  program.id === id ? { ...program, [field]: value } : program
                )
              }
            }));
          };

          const deleteAfterSchoolProgram = (day, id) => {
            setAfterSchoolPrograms(prev => ({
              ...prev,
              [scheduleMode]: {
                ...prev[scheduleMode],
                [day]: prev[scheduleMode][day].filter(program => program.id !== id)
              }
            }));
          };

          const updateSubject = (day, periodId, subject) => {
            setTimetables(prev => ({
              ...prev,
              [scheduleMode]: {
                ...prev[scheduleMode],
                [day]: {
                  ...prev[scheduleMode][day],
                  [periodId]: subject
                }
              }
            }));
          };

          const addFavoriteSubject = () => {
            if (newSubject && !favoriteSubjects.includes(newSubject)) {
              setFavoriteSubjects(prev => [...prev, newSubject]);
              setNewSubject('');
            }
          };

          const removeFavoriteSubject = (subject) => {
            setFavoriteSubjects(prev => prev.filter(s => s !== subject));
          };

          const handleCellClick = (day, periodId) => {
            if (editMode) {
              const isShortDay = (day === 3 || day === 5) && schoolSettings[scheduleMode].shortDayEnabled;
              if (isShortDay && (periodId === 'period5' || periodId.includes('period5'))) {
                return;
              }
              
              if (selectedSubject === 'ì§€ìš°ê¸°') {
                updateSubject(day, periodId, '');
              } else if (selectedSubject) {
                updateSubject(day, periodId, selectedSubject);
              }
            }
          };

          const getTodaySchedule = () => {
            const today = currentTime.getDay();
            if (today === 0 || today === 6) return { periods: [], afterSchool: [], dayIndex: today };
            
            const isShortDay = (today === 3 || today === 5) && 
                               schoolSettings[scheduleMode].shortDayEnabled &&
                               scheduleStructures[`${scheduleMode}_short`];
            
            const periods = isShortDay 
              ? scheduleStructures[`${scheduleMode}_short`] || []
              : scheduleStructure || [];
            
            const afterSchool = afterSchoolPrograms[scheduleMode][today] || [];
            
            return { periods, afterSchool, dayIndex: today, isShortDay };
          };

          const getEndTime = (dayIndex) => {
            const programs = afterSchoolPrograms[scheduleMode][dayIndex] || [];
            if (programs.length > 0) {
              const lastProgram = programs[programs.length - 1];
              return lastProgram.end;
            }
            
            const isShortDay = (dayIndex === 3 || dayIndex === 5) && 
                               schoolSettings[scheduleMode].shortDayEnabled;
            
            if (isShortDay && scheduleStructures[`${scheduleMode}_short`]) {
              const shortDaySchedule = scheduleStructures[`${scheduleMode}_short`];
              const sortedPeriods = sortPeriods(shortDaySchedule);
              const lastPeriod = sortedPeriods[sortedPeriods.length - 1];
              return lastPeriod?.end || '12:50';
            }
            
            if (Array.isArray(scheduleStructure)) {
              const sortedPeriods = sortPeriods(scheduleStructure);
              const lastPeriod = sortedPeriods[sortedPeriods.length - 1];
              return lastPeriod?.end || '13:30';
            }
            
            return '13:30';
          };

          const clearAllData = () => {
            if (window.confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
              if (typeof window !== 'undefined' && window.localStorage) {
                localStorage.clear();
              }
              window.location.reload();
            }
          };

          // ì‹œê°„í‘œ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
          const generateTimetableText = () => {
            const today = new Date();
            const dateStr = today.toLocaleDateString('ko-KR', { 
              year: 'numeric',
              month: 'long', 
              day: 'numeric' 
            });
            
            let text = `ğŸ“š ìš°ë¦¬ ì•„ì´ ì‹œê°„í‘œ\n`;
            text += `ğŸ“… ${dateStr} ê¸°ì¤€\n`;
            text += `${scheduleMode === 'vacation' ? 'ğŸŒ ë°©í•™ ì¤‘' : 'ğŸ« í•™ê¸° ì¤‘'}\n\n`;
            
            const todayDay = today.getDay();
            
            if (todayDay > 0 && todayDay < 6) {
              const isShortDay = (todayDay === 3 || todayDay === 5) && 
                                 schoolSettings[scheduleMode].shortDayEnabled &&
                                 scheduleStructures[`${scheduleMode}_short`];
              
              const periods = isShortDay 
                ? scheduleStructures[`${scheduleMode}_short`] || []
                : scheduleStructure || [];
              
              const afterSchool = afterSchoolPrograms[scheduleMode][todayDay] || [];
              const currentTimetable = timetables[scheduleMode];
              
              text += `ã€ì˜¤ëŠ˜ì˜ ì‹œê°„í‘œã€‘\n`;
              periods.forEach(period => {
                if (period.name === 'ì•„ì¹¨ë…ì„œ') {
                  text += `${period.start}~${period.end} ğŸ“š ${period.name}\n`;
                } else if (period.name === 'ì ì‹¬ì‹œê°„') {
                  text += `${period.start}~${period.end} ${period.name}: ğŸ½ï¸ ê¸‰ì‹\n`;
                } else if (!period.isBreak) {
                  const subject = currentTimetable[todayDay]?.[period.id] || 'ë¯¸ì •';
                  text += `${period.start}~${period.end} ${period.name}: ${subject}\n`;
                }
              });
              
              if (afterSchool.length > 0) {
                text += `\nã€ë°©ê³¼í›„ã€‘\n`;
                afterSchool.forEach(program => {
                  text += `${program.start}~${program.end} ${program.name || 'ë¯¸ì •'}\n`;
                });
              }
              
              text += `\nğŸ’™ í•˜êµì‹œê°„: ${getEndTime(todayDay)}\n`;
            } else {
              text += `ğŸ‰ ì˜¤ëŠ˜ì€ ì¦ê±°ìš´ ì£¼ë§ì´ì—ìš”!\n\n`;
              text += `ã€ì›”ìš”ì¼ ì‹œê°„í‘œ ë¯¸ë¦¬ë³´ê¸°ã€‘\n`;
              const mondayPeriods = scheduleStructure || [];
              const currentTimetable = timetables[scheduleMode];
              
              mondayPeriods.forEach(period => {
                if (period.name === 'ì•„ì¹¨ë…ì„œ') {
                  text += `${period.start}~${period.end} ğŸ“š ${period.name}\n`;
                } else if (period.name === 'ì ì‹¬ì‹œê°„') {
                  text += `${period.start}~${period.end} ${period.name}: ğŸ½ï¸ ê¸‰ì‹\n`;
                } else if (!period.isBreak) {
                  const subject = currentTimetable[1]?.[period.id] || 'ë¯¸ì •';
                  text += `${period.start}~${period.end} ${period.name}: ${subject}\n`;
                }
              });
            }
            
            text += `\nâ€» ìì„¸í•œ ì‹œê°„í‘œëŠ” ë§í¬ì—ì„œ í™•ì¸í•˜ì„¸ìš”`;
            
            return text;
          };

          // ê³µìœ í•˜ê¸°
          const shareTimeTable = async (method) => {
            const text = generateTimetableText();
            const url = window.location.href;
            const title = 'ìš°ë¦¬ ì•„ì´ ì‹œê°„í‘œ';
            
            if (method === 'webshare' && navigator.share) {
              try {
                await navigator.share({
                  title: title,
                  text: text,
                  url: url
                });
              } catch (err) {
                console.log('ê³µìœ  ì·¨ì†Œë¨');
              }
            } else if (method === 'copy') {
              const shareText = `${text}\n\nğŸ”— ${url}`;
              
              if (navigator.clipboard) {
                await navigator.clipboard.writeText(shareText);
                alert('ì‹œê°„í‘œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\nì¹´í†¡ì´ë‚˜ ë¬¸ìì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.');
              } else {
                const textarea = document.createElement('textarea');
                textarea.value = shareText;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('ì‹œê°„í‘œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
              }
            }
          };

          const { periods: todayPeriods, afterSchool: todayAfterSchool, dayIndex, isShortDay } = getTodaySchedule();
          const timetable = timetables[scheduleMode];

          // ì˜¨ë³´ë”© í™”ë©´
          if (isFirstVisit) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center p-4">
                <div className="max-w-md w-full bg-white rounded-2xl shadow-xl p-6 md:p-8">
                  {onboardingStep === 0 && (
                    <div className="text-center space-y-6">
                      <div className="inline-flex items-center justify-center w-20 h-20 bg-blue-100 rounded-full">
                        <i data-lucide="school" className="w-10 h-10 text-blue-600"></i>
                      </div>
                      <h1 className="text-2xl md:text-3xl font-bold text-gray-800">
                        ìš°ë¦¬ ì•„ì´ ì‹œê°„í‘œ
                      </h1>
                      <p className="text-gray-600">
                        ì´ˆë“±í•™êµ ì‹œê°„í‘œë¥¼ ì‰½ê²Œ ê´€ë¦¬í•˜ì„¸ìš”!<br/>
                        ë³µì¡í•œ í•™êµ ì¼ì •ì„ í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.
                      </p>
                      <button
                        onClick={() => setOnboardingStep(1)}
                        className="w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors flex items-center justify-center gap-2"
                      >
                        ì‹œì‘í•˜ê¸°
                        <i data-lucide="chevron-right" className="w-5 h-5"></i>
                      </button>
                    </div>
                  )}
                  
                  {onboardingStep === 1 && (
                    <div className="space-y-6">
                      <h2 className="text-xl font-bold text-gray-800">
                        ìë…€ì˜ í•™ë…„ì„ ì„ íƒí•´ì£¼ì„¸ìš”
                      </h2>
                      <div className="space-y-3">
                        {Object.entries(GRADE_TEMPLATES).map(([grade, template]) => (
                          <button
                            key={grade}
                            onClick={() => {
                              setFavoriteSubjects(template.subjects);
                              updateSchoolSettings('scheduleType', template.scheduleType);
                              setTimeout(() => generateAutoSchedule(), 100);
                              setOnboardingStep(2);
                            }}
                            className="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
                          >
                            <div className="font-medium text-gray-800">{grade}</div>
                            <div className="text-sm text-gray-500 mt-1">{template.message}</div>
                          </button>
                        ))}
                      </div>
                      <button
                        onClick={() => setOnboardingStep(0)}
                        className="w-full py-2 text-gray-500 hover:text-gray-700 flex items-center justify-center gap-1"
                      >
                        <i data-lucide="chevron-left" className="w-4 h-4"></i>
                        ì´ì „
                      </button>
                    </div>
                  )}
                  
                  {onboardingStep === 2 && (
                    <div className="space-y-6">
                      <div className="text-center">
                        <div className="inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4">
                          <i data-lucide="save" className="w-8 h-8 text-green-600"></i>
                        </div>
                        <h2 className="text-xl font-bold text-gray-800 mb-2">
                          ì¤€ë¹„ ì™„ë£Œ!
                        </h2>
                        <p className="text-gray-600">
                          ê¸°ë³¸ ì‹œê°„í‘œê°€ ì„¤ì •ë˜ì—ˆì–´ìš”.<br/>
                          ì´ì œ ê³¼ëª©ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!
                        </p>
                      </div>
                      
                      <div className="bg-blue-50 rounded-lg p-4 space-y-2">
                        <p className="text-sm font-medium text-blue-800">ğŸ’¡ ì‚¬ìš© íŒ</p>
                        <ul className="text-sm text-blue-600 space-y-1">
                          <li>â€¢ í¸ì§‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œê°„í‘œ ìˆ˜ì •</li>
                          <li>â€¢ ê³¼ëª©ì„ ì„ íƒí•˜ê³  ì¹¸ì„ í´ë¦­í•´ ì…ë ¥</li>
                          <li>â€¢ ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ë„ ì¶”ê°€ ê°€ëŠ¥</li>
                        </ul>
                      </div>
                      
                      <button
                        onClick={() => {
                          setIsFirstVisit(false);
                          if (typeof window !== 'undefined' && window.localStorage) {
                            localStorage.setItem('hasVisited', 'true');
                          }
                        }}
                        className="w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition-colors"
                      >
                        ì‹œê°„í‘œ ë§Œë“¤ê¸°
                      </button>
                    </div>
                  )}
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gray-50">
              {/* í—¤ë” */}
              <div className="bg-white shadow-sm border-b">
                <div className="max-w-7xl mx-auto px-4 py-4">
                  <div className="flex justify-between items-center">
                    <h1 className="text-xl md:text-2xl font-bold text-gray-800">ìš°ë¦¬ ì•„ì´ ì‹œê°„í‘œ</h1>
                    <div className="flex gap-1 md:gap-2">
                      <button
                        onClick={() => setScheduleMode(scheduleMode === 'regular' ? 'vacation' : 'regular')}
                        className={`px-3 py-2 md:px-4 md:py-2 rounded-lg font-medium transition-colors flex items-center gap-1 md:gap-2 text-sm md:text-base ${
                          scheduleMode === 'vacation' 
                            ? 'bg-orange-500 text-white hover:bg-orange-600' 
                            : 'bg-gray-500 text-white hover:bg-gray-600'
                        }`}
                      >
                        {scheduleMode === 'vacation' ? <i data-lucide="sun" className="w-4 h-4"></i> : <i data-lucide="school" className="w-4 h-4"></i>}
                        <span className="hidden sm:inline">{scheduleMode === 'vacation' ? 'ë°©í•™' : 'í•™ê¸°ì¤‘'}</span>
                      </button>
                      <button
                        onClick={() => setEditMode(!editMode)}
                        className={`px-3 py-2 md:px-4 md:py-2 rounded-lg font-medium transition-colors flex items-center gap-1 md:gap-2 text-sm md:text-base ${
                          editMode 
                            ? 'bg-green-500 text-white hover:bg-green-600' 
                            : 'bg-blue-500 text-white hover:bg-blue-600'
                        }`}
                      >
                        {editMode ? <i data-lucide="save" className="w-4 h-4"></i> : <i data-lucide="edit-2" className="w-4 h-4"></i>}
                        <span className="hidden sm:inline">{editMode ? 'ì €ì¥' : 'í¸ì§‘'}</span>
                      </button>
                      <button
                        onClick={() => {
                          if (window.confirm('ì‚¬ìš©ë²•ì„ ë‹¤ì‹œ ë³´ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            setIsFirstVisit(true);
                            setOnboardingStep(0);
                          }
                        }}
                        className="p-2 text-gray-500 hover:text-gray-700"
                        title="ë„ì›€ë§"
                      >
                        <i data-lucide="help-circle" className="w-4 h-4 md:w-5 md:h-5"></i>
                      </button>
                      <button
                        onClick={() => {
                          if (navigator.share) {
                            shareTimeTable('webshare');
                          } else {
                            shareTimeTable('copy');
                          }
                        }}
                        className="px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 flex items-center gap-1 md:gap-2 text-sm md:text-base font-medium shadow-md hover:shadow-lg transition-all"
                        title="ê³µìœ í•˜ê¸°"
                      >
                        <i data-lucide="share-2" className="w-4 h-4"></i>
                        <span className="hidden sm:inline">ê³µìœ </span>
                      </button>
                      <button
                        onClick={clearAllData}
                        className="p-2 text-gray-500 hover:text-gray-700"
                        title="ë°ì´í„° ì´ˆê¸°í™”"
                      >
                        <i data-lucide="settings" className="w-4 h-4 md:w-5 md:h-5"></i>
                      </button>
                    </div>
                  </div>
                  {editMode && (
                    <div className="mt-2 text-sm text-blue-600 bg-blue-50 rounded-lg px-3 py-2 flex items-center gap-2">
                      <i data-lucide="alert-circle" className="w-4 h-4"></i>
                      í¸ì§‘ ëª¨ë“œì…ë‹ˆë‹¤. ê³¼ëª©ì„ ì„ íƒí•œ í›„ ì‹œê°„í‘œë¥¼ í´ë¦­í•˜ì„¸ìš”!
                    </div>
                  )}
                </div>
              </div>

              {/* íƒ­ ë©”ë‰´ */}
              <div className="bg-white border-b sticky top-0 z-10">
                <div className="max-w-7xl mx-auto px-4">
                  <div className="flex gap-2 md:gap-6 overflow-x-auto">
                    <button
                      onClick={() => setActiveTab('today')}
                      className={`py-3 px-2 md:px-1 border-b-2 font-medium transition-colors whitespace-nowrap text-sm md:text-base ${
                        activeTab === 'today' 
                          ? 'border-blue-500 text-blue-600' 
                          : 'border-transparent text-gray-500 hover:text-gray-700'
                      }`}
                    >
                      ì˜¤ëŠ˜ ì¼ì •
                    </button>
                    <button
                      onClick={() => setActiveTab('timetable')}
                      className={`py-3 px-2 md:px-1 border-b-2 font-medium transition-colors whitespace-nowrap text-sm md:text-base ${
                        activeTab === 'timetable' 
                          ? 'border-blue-500 text-blue-600' 
                          : 'border-transparent text-gray-500 hover:text-gray-700'
                      }`}
                    >
                      ì£¼ê°„ ì‹œê°„í‘œ
                    </button>
                    <button
                      onClick={() => setActiveTab('schedule')}
                      className={`py-3 px-2 md:px-1 border-b-2 font-medium transition-colors whitespace-nowrap text-sm md:text-base ${
                        activeTab === 'schedule' 
                          ? 'border-blue-500 text-blue-600' 
                          : 'border-transparent text-gray-500 hover:text-gray-700'
                      }`}
                    >
                      ì‹œê°„ ì„¤ì •
                    </button>
                  </div>
                </div>
              </div>

              <div className="max-w-7xl mx-auto px-4 py-4 md:py-6">
                {/* ì˜¤ëŠ˜ ì¼ì • íƒ­ */}
                {activeTab === 'today' && (
                  <div className="space-y-4 md:space-y-6">
                    <div className={`rounded-xl p-4 md:p-6 text-white ${
                      scheduleMode === 'vacation' 
                        ? 'bg-gradient-to-r from-orange-500 to-yellow-600' 
                        : 'bg-gradient-to-r from-blue-500 to-purple-600'
                    }`}>
                      <div className="flex items-center justify-between mb-2">
                        <div className="flex items-center gap-2">
                          {scheduleMode === 'vacation' && <i data-lucide="sun" className="w-5 h-5 md:w-6 md:h-6"></i>}
                          <h2 className="text-xl md:text-2xl font-bold">
                            {currentTime.toLocaleDateString('ko-KR', { 
                              month: 'long', 
                              day: 'numeric',
                              weekday: 'long'
                            })}
                          </h2>
                        </div>
                        <button
                          onClick={() => {
                            if (navigator.share) {
                              shareTimeTable('webshare');
                            } else {
                              shareTimeTable('copy');
                            }
                          }}
                          className="bg-white/20 hover:bg-white/30 p-2 rounded-lg transition-colors"
                          title="ì‹œê°„í‘œ ê³µìœ í•˜ê¸°"
                        >
                          <i data-lucide="share-2" className="w-5 h-5"></i>
                        </button>
                      </div>
                      <p className="text-white/80 text-sm md:text-base">
                        {scheduleMode === 'vacation' ? 'ë°©í•™ ì¤‘' : 'í•™ê¸° ì¤‘'} Â· 
                        {dayIndex === 0 || dayIndex === 6 ? 'ì£¼ë§' : 
                          isShortDay ? 'ë‹¨ì¶•ìˆ˜ì—… (ê¸‰ì‹ í›„ í•˜êµ)' : `ìµœì¢… í•˜êµ: ${getEndTime(dayIndex)}`}
                      </p>
                    </div>

                    {/* ì£¼ë§ ì•ˆë‚´ */}
                    {(dayIndex === 0 || dayIndex === 6) && (
                      <div className="bg-yellow-50 rounded-lg p-6 text-center">
                        <i data-lucide="sun" className="w-12 h-12 text-yellow-500 mx-auto mb-3"></i>
                        <p className="text-lg font-medium text-gray-800 mb-2">ì¦ê±°ìš´ ì£¼ë§ì´ì—ìš”! ğŸ‰</p>
                        <p className="text-sm text-gray-600">ì›”ìš”ì¼ ì‹œê°„í‘œë¥¼ ë¯¸ë¦¬ í™•ì¸í•´ë³´ì„¸ìš”</p>
                        <button
                          onClick={() => setActiveTab('timetable')}
                          className="mt-3 text-sm font-medium text-blue-600 hover:text-blue-700"
                        >
                          ì£¼ê°„ ì‹œê°„í‘œ ë³´ê¸° â†’
                        </button>
                      </div>
                    )}

                    {/* ì •ê·œ ìˆ˜ì—… */}
                    {todayPeriods.length > 0 ? (
                      <div className="bg-white rounded-lg shadow">
                        <h3 className="font-semibold text-gray-800 p-4 border-b text-base md:text-lg">
                          {scheduleMode === 'vacation' ? 'ë°©í•™ í”„ë¡œê·¸ë¨' : 'ì •ê·œ ìˆ˜ì—…'}
                        </h3>
                        <div className="p-3 md:p-4 space-y-2">
                          {todayPeriods.map((period) => {
                            const subject = dayIndex && !period.isBreak ? timetable[dayIndex]?.[period.id] : '';
                            
                            if (period.name === 'ì•„ì¹¨ë…ì„œ') {
                              return (
                                <div key={period.id} className="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                                  <div className="flex items-center gap-2">
                                    <p className="text-sm md:text-base font-medium text-yellow-800">ğŸ“š {period.name}</p>
                                    <p className="text-xs md:text-sm text-yellow-600">
                                      {period.start} - {period.end}
                                    </p>
                                  </div>
                                </div>
                              );
                            }
                            
                            if (period.isBreak && period.name !== 'ì ì‹¬ì‹œê°„') {
                              return (
                                <div key={period.id} className="flex items-center justify-between p-2 md:p-2 bg-gray-50 rounded-lg">
                                  <div className="flex items-center gap-2">
                                    <p className="text-xs md:text-sm text-gray-600">{period.name}</p>
                                    <p className="text-xs text-gray-500">
                                      {period.start} - {period.end}
                                    </p>
                                  </div>
                                </div>
                              );
                            }
                            
                            return (
                              <div key={period.id} className={`flex items-center justify-between p-3 md:p-3 rounded-lg ${
                                period.name === 'ì ì‹¬ì‹œê°„' ? 'bg-orange-50' : 'bg-gray-50'
                              }`}>
                                <div className="min-w-0 flex-1">
                                  <p className="font-medium text-sm md:text-base">{period.name}</p>
                                  <p className="text-xs md:text-sm text-gray-500">
                                    {period.start} - {period.end}
                                  </p>
                                </div>
                                <div className="ml-2">
                                  {period.name === 'ì ì‹¬ì‹œê°„' ? (
                                    <p className="text-orange-600 text-sm md:text-base">
                                      ğŸ½ï¸ ê¸‰ì‹
                                    </p>
                                  ) : (
                                    <p className={`font-medium rounded px-2 py-1 md:px-3 md:py-1 text-xs md:text-sm ${
                                      subject ? getSubjectColor(subject) : 'text-gray-400'
                                    }`}>
                                      {subject || '-'}
                                    </p>
                                  )}
                                </div>
                              </div>
                            );
                          })}
                          
                          {/* ì‹œê°„í‘œê°€ ë¹„ì–´ìˆì„ ë•Œ ì•ˆë‚´ */}
                          {todayPeriods.filter(p => !p.isBreak).every(p => !timetable[dayIndex]?.[p.id]) && (
                            <div className="mt-4 p-4 bg-blue-50 rounded-lg text-center">
                              <p className="text-sm text-blue-600 mb-2">ì•„ì§ ì‹œê°„í‘œê°€ ë¹„ì–´ìˆì–´ìš”!</p>
                              <button
                                onClick={() => setActiveTab('timetable')}
                                className="text-sm font-medium text-blue-700 hover:text-blue-800"
                              >
                                ì‹œê°„í‘œ ì…ë ¥í•˜ëŸ¬ ê°€ê¸° â†’
                              </button>
                            </div>
                          )}
                        </div>
                      </div>
                    ) : (
                      <div className="bg-white rounded-lg shadow p-6 text-center">
                        <i data-lucide="school" className="w-12 h-12 text-gray-400 mx-auto mb-3"></i>
                        <p className="text-gray-600 mb-3">ì‹œê°„í‘œ ì„¤ì •ì´ í•„ìš”í•´ìš”</p>
                        <button
                          onClick={() => setActiveTab('schedule')}
                          className="text-sm font-medium text-blue-600 hover:text-blue-700"
                        >
                          ì‹œê°„ ì„¤ì •í•˜ëŸ¬ ê°€ê¸° â†’
                        </button>
                      </div>
                    )}

                    {/* ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ */}
                    {todayAfterSchool.length > 0 && (
                      <div className="bg-white rounded-lg shadow">
                        <h3 className="font-semibold text-gray-800 p-4 border-b text-base md:text-lg">
                          {scheduleMode === 'vacation' ? 'ì˜¤í›„ í”„ë¡œê·¸ë¨' : 'ë°©ê³¼í›„ í”„ë¡œê·¸ë¨'}
                        </h3>
                        <div className="p-3 md:p-4 space-y-2">
                          {todayAfterSchool.map((program) => (
                            <div key={program.id} className="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                              <div className="min-w-0 flex-1">
                                <p className="font-medium text-sm md:text-base">{program.name || 'í”„ë¡œê·¸ë¨ëª… ì—†ìŒ'}</p>
                                <p className="text-xs md:text-sm text-gray-500">
                                  {program.start} - {program.end}
                                </p>
                              </div>
                              <p className={`font-medium rounded px-2 py-1 md:px-3 md:py-1 text-xs md:text-sm ml-2 ${
                                getSubjectColor(program.name)
                              }`}>
                                {program.name || '-'}
                              </p>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}
                    
                    {/* ê³µìœ  ë²„íŠ¼ ì„¹ì…˜ - í•­ìƒ í‘œì‹œ */}
                    <div className="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg shadow p-4 border-2 border-green-200">
                      <h3 className="font-semibold text-gray-800 mb-3 text-base flex items-center justify-center gap-2">
                        <span className="text-2xl">ğŸ“¤</span>
                        ì‹œê°„í‘œ ê³µìœ í•˜ê¸°
                        <span className="text-2xl">ğŸ’¬</span>
                      </h3>
                      <div className={`grid ${navigator.share ? 'grid-cols-2' : 'grid-cols-1'} gap-3`}>
                        {navigator.share && (
                          <button
                            onClick={() => shareTimeTable('webshare')}
                            className="flex items-center justify-center gap-2 py-3 px-4 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors shadow-lg hover:shadow-xl transform hover:scale-105"
                          >
                            <i data-lucide="share-2" className="w-5 h-5"></i>
                            <span className="font-medium">ì¹´í†¡/ë¬¸ì ê³µìœ </span>
                          </button>
                        )}
                        <button
                          onClick={() => shareTimeTable('copy')}
                          className={`flex items-center justify-center gap-2 py-3 px-4 ${
                            navigator.share ? 'bg-blue-500 hover:bg-blue-600' : 'bg-green-500 hover:bg-green-600'
                          } text-white rounded-lg transition-colors shadow-lg hover:shadow-xl transform hover:scale-105`}
                        >
                          <i data-lucide="copy" className="w-5 h-5"></i>
                          <span className="font-medium">{navigator.share ? 'ë³µì‚¬í•˜ê¸°' : 'ì‹œê°„í‘œ ë³µì‚¬í•˜ê¸°'}</span>
                        </button>
                      </div>
                      <p className="text-xs text-gray-600 mt-3 text-center font-medium">
                        {navigator.share 
                          ? 'ğŸ‘µ í• ë¨¸ë‹ˆ, ğŸ‘´ í• ì•„ë²„ì§€, ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡±ë“¤ê³¼ ì‹œê°„í‘œë¥¼ ê³µìœ í•´ë³´ì„¸ìš”!'
                          : 'ğŸ“‹ ë³µì‚¬í•œ ë‚´ìš©ì„ ì¹´í†¡ì´ë‚˜ ë¬¸ìì— ë¶™ì—¬ë„£ì–´ ê³µìœ í•˜ì„¸ìš”!'}
                      </p>
                    </div>
                  </div>
                )}

                {/* ì£¼ê°„ ì‹œê°„í‘œ íƒ­ */}
                {activeTab === 'timetable' && (
                  <div className="space-y-4">
                    {/* ê³¼ëª© ì„ íƒ íŒ¨ë„ */}
                    {editMode && (
                      <div className="bg-white rounded-lg shadow p-4">
                        <div className="mb-4">
                          <h3 className="text-sm font-medium text-gray-700 mb-3">
                            ğŸ“ ê³¼ëª© ì„ íƒ (í´ë¦­í•´ì„œ ì„ íƒ â†’ ì‹œê°„í‘œ ì¹¸ í´ë¦­)
                          </h3>
                          <div className="flex flex-wrap gap-2">
                            <button
                              onClick={() => setSelectedSubject(selectedSubject === 'ì§€ìš°ê¸°' ? '' : 'ì§€ìš°ê¸°')}
                              className={`px-4 py-2 rounded-full text-sm font-medium border-2 transition-all ${
                                selectedSubject === 'ì§€ìš°ê¸°' 
                                  ? 'bg-red-100 text-red-700 border-red-300 scale-105 shadow-lg ring-2 ring-red-300' 
                                  : 'bg-gray-100 text-gray-700 border-gray-300 hover:border-gray-400'
                              }`}
                            >
                              <i data-lucide="x" className="w-4 h-4 inline-block mr-1"></i>
                              ì§€ìš°ê¸°
                            </button>
                            {favoriteSubjects.map(subj => (
                              <div key={subj} className="relative group">
                                <button
                                  onClick={() => setSelectedSubject(subj === selectedSubject ? '' : subj)}
                                  className={`px-4 py-2 rounded-full text-sm font-medium border-2 transition-all ${
                                    selectedSubject === subj 
                                      ? `${getSubjectColor(subj)} scale-105 shadow-lg ring-2 ring-blue-300` 
                                      : `${getSubjectColor(subj)} border-transparent hover:border-current hover:scale-105`
                                  }`}
                                >
                                  {selectedSubject === subj && 'âœ“ '}
                                  {subj}
                                </button>
                                <button
                                  onClick={() => removeFavoriteSubject(subj)}
                                  className="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-5 h-5 text-xs opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center hover:bg-red-600"
                                >
                                  Ã—
                                </button>
                              </div>
                            ))}
                          </div>
                        </div>
                        
                        <div className="border-t pt-3">
                          <p className="text-xs text-gray-500 mb-2">ìì£¼ ì“°ëŠ” ê³¼ëª© ì¶”ê°€í•˜ê¸°:</p>
                          <div className="flex gap-2">
                            <input
                              type="text"
                              value={newSubject}
                              onChange={(e) => setNewSubject(e.target.value)}
                              onKeyPress={(e) => e.key === 'Enter' && addFavoriteSubject()}
                              placeholder="ìƒˆ ê³¼ëª©ëª… ì…ë ¥"
                              className="flex-1 px-3 py-2 border rounded-lg text-sm md:text-base"
                            />
                            <button
                              onClick={addFavoriteSubject}
                              className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm md:text-base font-medium"
                            >
                              ì¶”ê°€
                            </button>
                          </div>
                        </div>
                        
                        {selectedSubject && (
                          <div className="mt-3 p-2 bg-blue-50 rounded-lg flex items-center gap-2">
                            <span className={`px-3 py-1 rounded-full text-sm font-medium ${getSubjectColor(selectedSubject)}`}>
                              {selectedSubject}
                            </span>
                            <span className="text-sm text-blue-600">ì„ íƒë¨ â†’ ì‹œê°„í‘œë¥¼ í´ë¦­í•˜ì„¸ìš”!</span>
                          </div>
                        )}
                      </div>
                    )}
                    
                    {/* ì •ê·œ ì‹œê°„í‘œ */}
                    <div className="bg-white rounded-lg shadow overflow-hidden">
                      <div className="flex justify-between items-center p-4 border-b">
                        <h3 className="font-semibold text-gray-800 flex items-center gap-2">
                          {scheduleMode === 'vacation' ? 'ë°©í•™ í”„ë¡œê·¸ë¨' : 'ì •ê·œ ìˆ˜ì—…'}
                          {scheduleMode === 'vacation' && <i data-lucide="sun" className="w-4 h-4 text-orange-500"></i>}
                        </h3>
                        <button
                          onClick={() => {
                            if (navigator.share) {
                              shareTimeTable('webshare');
                            } else {
                              shareTimeTable('copy');
                            }
                          }}
                          className="px-3 py-1.5 bg-green-500 text-white rounded-lg hover:bg-green-600 flex items-center gap-1 text-sm font-medium"
                          title="ì‹œê°„í‘œ ê³µìœ í•˜ê¸°"
                        >
                          <i data-lucide="share-2" className="w-4 h-4"></i>
                          ê³µìœ 
                        </button>
                      </div>
                      
                      {/* ì‹œê°„í‘œê°€ ì™„ì „íˆ ë¹„ì–´ìˆì„ ë•Œ ì•ˆë‚´ */}
                      {!editMode && Object.values(timetable).every(day => 
                        Object.values(day).every(subject => !subject)
                      ) && (
                        <div className="p-8 text-center bg-blue-50">
                          <i data-lucide="school" className="w-16 h-16 text-blue-400 mx-auto mb-4"></i>
                          <h4 className="text-lg font-medium text-gray-800 mb-2">
                            ì‹œê°„í‘œë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”!
                          </h4>
                          <p className="text-sm text-gray-600 mb-4">
                            í¸ì§‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê³¼ëª©ì„ ì¶”ê°€í•  ìˆ˜ ìˆì–´ìš”
                          </p>
                          <button
                            onClick={() => setEditMode(true)}
                            className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-medium"
                          >
                            <i data-lucide="edit-2" className="w-4 h-4 inline-block mr-2"></i>
                            ì‹œê°„í‘œ í¸ì§‘í•˜ê¸°
                          </button>
                        </div>
                      )}
                      
                      <div className="overflow-x-auto">
                        <table className="w-full">
                          <thead>
                            <tr className="bg-gray-50">
                              <th className="p-3 text-left text-sm sticky left-0 bg-gray-50">ì‹œê°„</th>
                              {days.map((day, index) => (
                                <th key={index} className="p-3 text-center text-sm min-w-[100px]">{day}ìš”ì¼</th>
                              ))}
                            </tr>
                          </thead>
                          <tbody>
                            {Array.isArray(scheduleStructure) && scheduleStructure.map((period) => {
                              if (period.name === 'ì ì‹¬ì‹œê°„') {
                                return (
                                  <tr key={period.id} className="border-t">
                                    <td className="p-3 text-sm sticky left-0 bg-white">
                                      <div className="font-medium">{period.name}</div>
                                      <div className="text-xs text-gray-500">{period.start}-{period.end}</div>
                                    </td>
                                    {days.map((_, dayNum) => (
                                      <td key={dayNum} className="p-2">
                                        <div className="bg-orange-100 text-orange-700 rounded p-2 text-center text-sm">
                                          ê¸‰ì‹
                                        </div>
                                      </td>
                                    ))}
                                  </tr>
                                );
                              }
                              
                              if (period.name === 'ì•„ì¹¨ë…ì„œ') {
                                return (
                                  <tr key={period.id} className="border-t bg-yellow-50">
                                    <td className="p-3 text-sm sticky left-0 bg-yellow-50">
                                      <div className="font-medium text-yellow-800">ğŸ“š {period.name}</div>
                                      <div className="text-xs text-yellow-600">{period.start}-{period.end}</div>
                                    </td>
                                    {days.map((_, dayNum) => (
                                      <td key={dayNum} className="p-2">
                                        <div className="text-center text-sm text-yellow-700">
                                          ğŸ“–
                                        </div>
                                      </td>
                                    ))}
                                  </tr>
                                );
                              }
                              
                              if (period.isBreak) {
                                return (
                                  <tr key={period.id} className="border-t bg-gray-50">
                                    <td className="p-3 text-sm sticky left-0 bg-gray-50">
                                      <div className="font-medium text-gray-600">{period.name}</div>
                                      <div className="text-xs text-gray-500">{period.start}-{period.end}</div>
                                    </td>
                                    {days.map((_, dayNum) => (
                                      <td key={dayNum} className="p-2">
                                        <div className="text-center text-sm text-gray-500">
                                          -
                                        </div>
                                      </td>
                                    ))}
                                  </tr>
                                );
                              }
                              
                              return (
                                <tr key={period.id} className="border-t">
                                  <td className="p-3 text-sm sticky left-0 bg-white">
                                    <div className="font-medium">
                                      {period.name}
                                      {period.blockName && (
                                        <span className="text-xs text-gray-500 ml-1">({period.blockName})</span>
                                      )}
                                    </div>
                                    <div className="text-xs text-gray-500">{period.start}-{period.end}</div>
                                  </td>
                                  {days.map((_, dayNum) => {
                                    const dayIndex = dayNum + 1;
                                    const isShortDay = (dayIndex === 3 || dayIndex === 5) && 
                                                     schoolSettings[scheduleMode].shortDayEnabled;
                                    
                                    if (isShortDay && (period.id === 'period5' || period.id.includes('period5'))) {
                                      return (
                                        <td key={dayNum} className="p-2 bg-gray-100">
                                          <div className="text-center text-sm text-gray-400">
                                            -
                                          </div>
                                        </td>
                                      );
                                    }
                                    
                                    const subject = timetable[dayIndex]?.[period.id] || '';
                                    
                                    return (
                                      <td 
                                        key={dayNum} 
                                        className={`p-2 ${editMode ? 'cursor-pointer hover:bg-gray-50' : ''} transition-colors`}
                                        onClick={() => handleCellClick(dayIndex, period.id)}  // ì´ ë¶€ë¶„ ìˆ˜ì •!
                                      >
                                        <div className={`rounded p-2 text-center text-sm font-medium border transition-all ${
                                          subject ? getSubjectColor(subject) : 'text-gray-400 border-gray-200'
                                        } ${editMode ? 'hover:scale-105 hover:shadow-md' : ''}`}>
                                          {subject || (editMode ? 'í´ë¦­' : '-')}
                                        </div>
                                      </td>
                                    );
                                  })}
                                </tr>
                              );
                            })}
                            
                            {/* ìˆ˜ê¸ˆ ë‹¨ì¶•ìˆ˜ì—… ì•ˆë‚´ */}
                            {schoolSettings[scheduleMode].shortDayEnabled && (
                              <tr className="border-t bg-yellow-50">
                                <td colSpan={6} className="p-2 text-center text-sm text-yellow-800">
                                  â€» ìˆ˜Â·ê¸ˆìš”ì¼ì€ ê¸‰ì‹ í›„ í•˜êµ (12:50)
                                </td>
                              </tr>
                            )}
                          </tbody>
                        </table>
                      </div>
                    </div>

                    {/* ë°©ê³¼í›„ í”„ë¡œê·¸ë¨ */}
                    <div className="bg-white rounded-lg shadow">
                      <h3 className="font-semibold text-gray-800 p-4 border-b">
                        {scheduleMode === 'vacation' ? 'ì˜¤í›„ í”„ë¡œê·¸ë¨' : 'ë°©ê³¼í›„ í”„ë¡œê·¸ë¨'}
                      </h3>
                      <div className="p-4 space-y-4">
                        {days.map((day, dayNum) => {
                          const dayIndex = dayNum + 1;
                          const programs = afterSchoolPrograms[scheduleMode][dayIndex] || [];
                          
                          return (
                            <div key={dayIndex} className="border rounded-lg p-3">
                              <div className="flex justify-between items-center mb-2">
                                <h4 className="font-medium text-gray-700">{day}ìš”ì¼</h4>
                                {editMode && (
                                  <button
                                    onClick={() => addAfterSchoolProgram(dayIndex)}
                                    className="text-sm text-blue-600 hover:text-blue-700"
                                  >
                                    + ì¶”ê°€
                                  </button>
                                )}
                              </div>
                              
                              {programs.length === 0 ? (
                                <p className="text-sm text-gray-400">í”„ë¡œê·¸ë¨ ì—†ìŒ</p>
                              ) : (
                                <div className="space-y-2">
                                  {programs.map(program => (
                                    <div key={program.id} className="flex gap-2 items-center">
                                      {editMode ? (
                                        <>
                                          <input
                                            type="text"
                                            value={program.name}
                                            onChange={(e) => updateAfterSchoolProgram(dayIndex, program.id, 'name', e.target.value)}
                                            placeholder="í”„ë¡œê·¸ë¨ëª…"
                                            className="flex-1 px-2 py-1 border rounded text-sm"
                                          />
                                          <input
                                            type="time"
                                            value={program.start}
                                            onChange={(e) => updateAfterSchoolProgram(dayIndex, program.id, 'start', e.target.value)}
                                            className="px-2 py-1 border rounded text-sm"
                                          />
                                          <span>~</span>
                                          <input
                                            type="time"
                                            value={program.end}
                                            onChange={(e) => updateAfterSchoolProgram(dayIndex, program.id, 'end', e.target.value)}
                                            className="px-2 py-1 border rounded text-sm"
                                          />
                                          <button
                                            onClick={() => deleteAfterSchoolProgram(dayIndex, program.id)}
                                            className="text-red-500 hover:text-red-700"
                                          >
                                            <i data-lucide="trash-2" className="w-4 h-4"></i>
                                          </button>
                                        </>
                                      ) : (
                                        <div className="flex-1 flex justify-between items-center">
                                          <span className={`text-sm font-medium px-2 py-1 rounded ${getSubjectColor(program.name)}`}>
                                            {program.name || 'ë¯¸ì…ë ¥'}
                                          </span>
                                          <span className="text-sm text-gray-500">
                                            {program.start} ~ {program.end}
                                          </span>
                                        </div>
                                      )}
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  </div>
                )}

                {/* ì‹œê°„ ì„¤ì • íƒ­ */}
                {activeTab === 'schedule' && (
                  <div className="space-y-4">
                    {/* ê¸°ë³¸ ì„¤ì • */}
                    <div className="bg-white rounded-lg shadow p-6">
                      <h3 className="font-semibold text-gray-800 mb-4 flex items-center gap-2">
                        ê¸°ë³¸ ì„¤ì •
                        {scheduleMode === 'vacation' && <i data-lucide="sun" className="w-4 h-4 text-orange-500"></i>}
                      </h3>
                      <div className="space-y-4">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                              ì‹œê°„í‘œ ìœ í˜•
                            </label>
                            <select
                              value={schoolSettings[scheduleMode].scheduleType}
                              onChange={(e) => updateSchoolSettings('scheduleType', e.target.value)}
                              disabled={!editMode}
                              className="w-full px-3 py-2 border rounded-lg disabled:bg-gray-100"
                            >
                              <option value="regular">ì¼ë°˜ ì‹œê°„í‘œ (1êµì‹œ, 2êµì‹œ...)</option>
                              <option value="block">ë¸”ë¡ ì‹œê°„í‘œ (1ë¸”ë¡, 2ë¸”ë¡...)</option>
                              <option value="mixed">í˜¼í•©í˜• (ë¸”ë¡+êµì‹œ í‘œì‹œ)</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                              ì²« ìˆ˜ì—… ì‹œì‘ì‹œê°„
                            </label>
                            <select
                              value={schoolSettings[scheduleMode].startTime}
                              onChange={(e) => updateSchoolSettings('startTime', e.target.value)}
                              disabled={!editMode}
                              className="w-full px-3 py-2 border rounded-lg disabled:bg-gray-100"
                            >
                              <option value="08:30">8:30</option>
                              <option value="08:40">8:40</option>
                              <option value="08:50">8:50</option>
                              <option value="09:00">9:00</option>
                              <option value="09:10">9:10</option>
                              <option value="09:20">9:20</option>
                            </select>
                          </div>
                        </div>
                        
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                              ìˆ˜ì—… ì‹œê°„ (ë¶„)
                            </label>
                            <select
                              value={schoolSettings[scheduleMode].periodDuration}
                              onChange={(e) => updateSchoolSettings('periodDuration', e.target.value)}
                              disabled={!editMode}
                              className="w-full px-3 py-2 border rounded-lg disabled:bg-gray-100"
                            >
                              <option value="30">30ë¶„</option>
                              <option value="35">35ë¶„</option>
                              <option value="40">40ë¶„</option>
                              <option value="45">45ë¶„</option>
                              <option value="50">50ë¶„</option>
                              <option value="60">60ë¶„ (1ì‹œê°„)</option>
                              <option value="70">70ë¶„</option>
                              <option value="80">80ë¶„</option>
                              <option value="90">90ë¶„ (1ì‹œê°„ 30ë¶„)</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                              ì‰¬ëŠ”ì‹œê°„ (ë¶„)
                            </label>
                            <select
                              value={schoolSettings[scheduleMode].breakDuration}
                              onChange={(e) => updateSchoolSettings('breakDuration', e.target.value)}
                              disabled={!editMode}
                              className="w-full px-3 py-2 border rounded-lg disabled:bg-gray-100"
                            >
                              <option value="5">5ë¶„</option>
                              <option value="10">10ë¶„</option>
                              <option value="15">15ë¶„</option>
                              <option value="20">20ë¶„</option>
                              <option value="25">25ë¶„</option>
                              <option value="30">30ë¶„</option>
                            </select>
                          </div>
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                              ì ì‹¬ì‹œê°„ (ë¶„)
                            </label>
                            <select
                              value={schoolSettings[scheduleMode].lunchDuration || 50}
                              onChange={(e) => updateSchoolSettings('lunchDuration', e.target.value)}
                              disabled={!editMode}
                              className="w-full px-3 py-2 border rounded-lg disabled:bg-gray-100"
                            >
                              <option value="30">30ë¶„</option>
                              <option value="40">40ë¶„</option>
                              <option value="45">45ë¶„</option>
                              <option value="50">50ë¶„</option>
                              <option value="55">55ë¶„</option>
                              <option value="60">60ë¶„ (1ì‹œê°„)</option>
                              <option value="70">70ë¶„</option>
                              <option value="80">80ë¶„</option>
                              <option value="90">90ë¶„ (1ì‹œê°„ 30ë¶„)</option>
                            </select>
                          </div>
                        </div>
                        
                        {scheduleMode === 'regular' && (
                          <div className="space-y-3">
                            <div className="flex items-center gap-2">
                              <input
                                type="checkbox"
                                id="morningReading"
                                checked={schoolSettings[scheduleMode].morningReadingEnabled}
                                onChange={(e) => updateSchoolSettings('morningReadingEnabled', e.target.checked)}
                                disabled={!editMode}
                                className="rounded"
                              />
                              <label htmlFor="morningReading" className="text-sm text-gray-700">
                                ì•„ì¹¨ë…ì„œ ì‹œê°„ (08:40~08:50)
                              </label>
                            </div>
                            <div className="flex items-center gap-2">
                              <input
                                type="checkbox"
                                id="shortDay"
                                checked={schoolSettings[scheduleMode].shortDayEnabled}
                                onChange={(e) => updateSchoolSettings('shortDayEnabled', e.target.checked)}
                                disabled={!editMode}
                                className="rounded"
                              />
                              <label htmlFor="shortDay" className="text-sm text-gray-700">
                                ìˆ˜Â·ê¸ˆìš”ì¼ ë‹¨ì¶•ìˆ˜ì—… (ê¸‰ì‹ í›„ í•˜êµ)
                              </label>
                            </div>
                          </div>
                        )}
                      </div>
                      
                      {editMode && (
                        <div className="mt-4 flex flex-wrap gap-2">
                          <button
                            onClick={generateAutoSchedule}
                            className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
                          >
                            ìë™ ì‹œê°„í‘œ ìƒì„±
                          </button>
                          <div className="flex gap-2">
                            <span className="text-sm text-gray-600 flex items-center">ë¹ ë¥¸ ì„¤ì •:</span>
                            {Object.entries(GRADE_TEMPLATES).map(([grade, template]) => (
                              <button
                                key={grade}
                                onClick={() => {
                                  updateSchoolSettings('scheduleType', template.scheduleType);
                                  setFavoriteSubjects(template.subjects);
                                  setTimeout(() => generateAutoSchedule(), 100);
                                }}
                                className="px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm"
                              >
                                {grade}
                              </button>
                            ))}
                          </div>
                          {schoolSettings[scheduleMode].scheduleType === 'block' && (
                            <div className="w-full text-sm text-gray-600 flex items-center gap-1">
                              <i data-lucide="alert-circle" className="w-4 h-4"></i>
                              ë¸”ë¡ ì‹œê°„í‘œëŠ” 1-2í•™ë…„ ë§ì¶¤í˜• í”„ë¡œê·¸ë¨ìš©ì…ë‹ˆë‹¤
                            </div>
                          )}
                        </div>
                      )}
                    </div>

                    {/* ì„¸ë¶€ ì‹œê°„ ì„¤ì • */}
                    <div className="bg-white rounded-lg shadow p-6">
                      <div className="flex justify-between items-center mb-4">
                        <div>
                          <h3 className="font-semibold text-gray-800 flex items-center gap-2">
                            {scheduleMode === 'vacation' ? 'ë°©í•™ ì‹œê°„í‘œ ì„¤ì •' : 'ì •ê·œ ì‹œê°„í‘œ ì„¤ì •'}
                            {scheduleMode === 'vacation' && <i data-lucide="sun" className="w-4 h-4 text-orange-500"></i>}
                          </h3>
                          <p className="text-sm text-gray-600 mt-1">
                            ì´ {scheduleStructure.filter(p => !p.isBreak).length}ê°œ ìˆ˜ì—…, 
                            ì‰¬ëŠ”ì‹œê°„ {scheduleStructure.filter(p => p.isBreak).length}ê°œ
                          </p>
                        </div>
                        <div className="flex items-center gap-4">
                          {editMode && (
                            <>
                              <label className="flex items-center gap-2">
                                <input
                                  type="checkbox"
                                  checked={autoAdjustTime}
                                  onChange={(e) => setAutoAdjustTime(e.target.checked)}
                                  className="rounded"
                                />
                                <span className="text-sm text-gray-600">ìë™ ì‹œê°„ ì¡°ì •</span>
                              </label>
                              <button
                                onClick={addPeriod}
                                className="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center gap-1"
                              >
                                <i data-lucide="plus" className="w-4 h-4"></i>
                                ì‹œê°„ ì¶”ê°€
                              </button>
                            </>
                          )}
                        </div>
                      </div>
                      
                      <div className="space-y-2">
                        {Array.isArray(scheduleStructure) && scheduleStructure.map((period, index) => (
                          <div key={period.id} className="flex gap-2 items-center p-2 border rounded">
                            {editMode ? (
                              <>
                                <input
                                  type="text"
                                  value={period.name}
                                  onChange={(e) => updatePeriod(period.id, 'name', e.target.value)}
                                  className="w-32 px-2 py-1 border rounded"
                                />
                                <input
                                  type="time"
                                  value={period.start}
                                  onChange={(e) => updatePeriod(period.id, 'start', e.target.value)}
                                  className="px-2 py-1 border rounded"
                                />
                                <span>~</span>
                                <input
                                  type="time"
                                  value={period.end}
                                  onChange={(e) => updatePeriod(period.id, 'end', e.target.value)}
                                  className="px-2 py-1 border rounded"
                                />
                                <label className="flex items-center gap-1">
                                  <input
                                    type="checkbox"
                                    checked={period.isBreak}
                                    onChange={(e) => updatePeriod(period.id, 'isBreak', e.target.checked)}
                                  />
                                  <span className="text-sm">ì‰¬ëŠ”ì‹œê°„</span>
                                </label>
                                <button
                                  onClick={() => deletePeriod(period.id)}
                                  className="ml-auto text-red-500 hover:text-red-700"
                                >
                                  <i data-lucide="trash-2" className="w-4 h-4"></i>
                                </button>
                              </>
                            ) : (
                              <>
                                <span className={`w-32 font-medium ${period.isBreak ? 'text-orange-600' : ''}`}>
                                  {period.name}
                                </span>
                                <span className="text-gray-600">
                                  {period.start} ~ {period.end}
                                </span>
                                {period.isBreak && (
                                  <span className="text-sm text-orange-600">(ì‰¬ëŠ”ì‹œê°„)</span>
                                )}
                              </>
                            )}
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="bg-blue-50 rounded-lg p-4 text-sm text-blue-800">
                      <p className="font-medium mb-2">ğŸ’¡ ì‚¬ìš© íŒ</p>
                      <ul className="space-y-1 text-blue-600">
                        <li>â€¢ <strong>ì‹œê°„í‘œ ìœ í˜• ì„ íƒ:</strong> ì¼ë°˜(1,2,3êµì‹œ) / ë¸”ë¡(1ë¸”ë¡,2ë¸”ë¡) / í˜¼í•©í˜•</li>
                        <li>â€¢ <strong>ìˆ˜ê¸ˆ ë‹¨ì¶•ìˆ˜ì—…:</strong> ì²´í¬í•˜ë©´ ìˆ˜Â·ê¸ˆì€ ê¸‰ì‹ í›„ í•˜êµë¡œ ìë™ ì„¤ì •</li>
                        <li>â€¢ <strong>ìë™ ìƒì„± í›„</strong> ì„¸ë¶€ ì‹œê°„ì€ ì•„ë˜ì—ì„œ ìˆ˜ì • ê°€ëŠ¥</li>
                        <li>â€¢ ìë™ ì‹œê°„ ì¡°ì •: í•œ êµì‹œ ëì‹œê°„ ë³€ê²½ ì‹œ ë‹¤ìŒ êµì‹œ ì‹œì‘ì‹œê°„ ìë™ ì¡°ì •</li>
                        <li>â€¢ <span className="text-red-600 font-medium">ì£¼ì˜: êµì‹œ ì‚­ì œ ì‹œ í•´ë‹¹ êµì‹œì˜ ëª¨ë“  ê³¼ëª©ë„ ì‚­ì œë©ë‹ˆë‹¤</span></li>
                      </ul>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TimetableApp />);
    </script>
</body>
</html>
